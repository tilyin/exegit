#!/usr/bin/env bash
current_dir=$(pwd)

cd $HOME/git
dir_list=$(sudo find -H ./ -depth -name '.git' -ls | awk '{ print $11 }' | awk -F / '{ print $1"/"$2 }')
dir_list="$dir_list $HOME/Documents"

for dir_name in $dir_list
do
  cd $dir_name
  echo
  echo -e "\033[01;34m$(whoami)@$(hostname):$(pwd)\033[00m"
  echo -e "\033[00;32m---------------------------------------------------------------------------------\033[00m"
  git status | awk '{ if( $0 ~ /^\// && $0 !~ /origin\/master/) { DIR=$0; print "DIR: " DIR; }; if( $0 ~ /untracked/ || $0 ~ /not staged/ ){ system("git add . && git commit -m \"work in progress as of $(date -u --rfc-3339=s) \" && git push") } }'

  if [[ $(echo $(git config --get remote.origin.url)) =~ "ssh://" ]]; then
    ssh -p 4961 master@95.165.133.121 "cd git/$(basename $(pwd)).git; echo; pwd; git push; ssh -p 4961 tim@10.1.1.250 \"cd /var/services/homes/tim/git/$(basename $(pwd)).git; echo; pwd; git push;\";"
  fi

  cd $HOME/git
  echo -e "\033[00;32m_________________________________________________________________________________\033[00m"
  echo "  "
  echo "  "
done

cd $current_dir
