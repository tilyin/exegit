#!/usr/bin/env bash
echo "usage: $0 {{comments}}"
echo
comments=$@

if [[ -z "$comments" ]]; then
  comments="work in progress as of $(date -u +%Y-%m-%dT%H:%M:%S%Z)"
  # Alternative date format $(date -u --rfc-3339=s)
  echo "auto comment set: $comments"
  echo
else
  comments="$comments at $(date -u +%Y-%m-%d_T_%H:%M:%S_%Z)"
  echo "$comments"
  echo
fi

CURRENT=$(pwd)
echo ${CURRENT}
while [[ ! $(ls -lah | awk '/\.git/ { print $9 }') ]]
do
  cd ..
done

git add .
echo
git commit -m "$comments"
echo
git push -u origin master

if [[ $(git config --get remote.origin.url) == *"95.165.133.121"* ]]; then
  ssh -p 4961 git@95.165.133.121 "cd repo/$(basename $(pwd)).git; echo && echo \"git@95.165.133.121:4961/home/git/repo/$(basename $(pwd)).git$ git push\"; git push; ssh -p 4959 tim@95.165.133.121 \"cd git/$(basename $(pwd)).git; echo; git push; exit; \"; "
elif [[ $(git config --get remote.origin.url) == *"localhost"* ]]; then
  ssh -p 4961 git@localhost "cd repo/$(basename $(pwd)).git; echo && echo \"git@localhost:4961/home/git/repo/$(basename $(pwd)).git$ git push\"; git push; ssh -p 4961 tim@10.1.1.250 \"cd git/$(basename $(pwd)).git; echo; git push; exit; \"; "
fi

cd ${CURRENT}
